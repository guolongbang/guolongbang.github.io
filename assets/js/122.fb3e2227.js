(window.webpackJsonp=window.webpackJsonp||[]).push([[122],{449:function(a,t,s){"use strict";s.r(t);var n=s(7),e=Object(n.a)({},(function(){var a=this,t=a._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[t("h1",{attrs:{id:"工厂-模拟太阳光阴影"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#工厂-模拟太阳光阴影"}},[a._v("#")]),a._v(" 工厂(模拟太阳光阴影)")]),a._v(" "),t("p",[a._v("真实生活中物体在太阳光下往往是有影子的，在threejs你可以通过平行光阴影模拟太阳光阴影。")]),a._v(" "),t("h3",{attrs:{id:"工厂设置平行光阴影"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#工厂设置平行光阴影"}},[a._v("#")]),a._v(" 工厂设置平行光阴影")]),a._v(" "),t("p",[a._v("首先你可以先回顾一下前面讲解的"),t("strong",[a._v("11.2 平行光阴影计算")]),a._v("，设置工厂3D场景的平行光阴影流程是一样的。")]),a._v(" "),t("p",[a._v("和前面设置一样，允许"),t("strong",[a._v("光源")]),a._v("和"),t("strong",[a._v("渲染器")]),a._v("光源投影计算。")]),a._v(" "),t("div",{staticClass:"language-javascript extra-class"},[t("pre",{pre:!0,attrs:{class:"language-javascript"}},[t("code",[a._v("directionalLight"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("castShadow "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[a._v("true")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\nrenderer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("shadowMap"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("enabled "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[a._v("true")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v(" \n")])])]),t("ul",[t("li",[t("code",[a._v(".castShadow")]),a._v("设置"),t("strong",[a._v("产生阴影")]),a._v("的模型对象")]),a._v(" "),t("li",[t("code",[a._v(".receiveShadow")]),a._v("设置"),t("strong",[a._v("接收阴影")]),a._v("效果的模型")])]),a._v(" "),t("p",[a._v("实际生活中所有物体都可以产生阴影，同时所有物体都可以接收其它物体的阴影，所以所有Mesh都批量设置"),t("code",[a._v(".castShadow")]),a._v("和"),t("code",[a._v(".receiveShadow")]),a._v("属性。")]),a._v(" "),t("div",{staticClass:"language-javascript extra-class"},[t("pre",{pre:!0,attrs:{class:"language-javascript"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("//递归遍历场景，允许所有Mesh产生投影、接收投影")]),a._v("\ngltf"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("scene"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("traverse")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("function")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token parameter"}},[a._v("obj")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("if")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("obj"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("isMesh"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("//判断是否是网格模型")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// 批量设置所有Mesh都可以产生阴影和接收阴影")]),a._v("\n        obj"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("castShadow "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[a._v("true")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n        obj"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("receiveShadow "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[a._v("true")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])])]),t("h3",{attrs:{id:"设置工厂阴影范围"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#设置工厂阴影范围"}},[a._v("#")]),a._v(" 设置工厂阴影范围")]),a._v(" "),t("p",[a._v("首先要明确工厂需要阴影计算的尺寸范围，课件源码中提供的工厂尺寸量级大概是100左右，然后根据工厂尺寸量级设置光源阴影范围参数"),t("code",[a._v(".shadow.camera")]),a._v("。")]),a._v(" "),t("p",[a._v("可以先根据工厂尺寸，预先设置"),t("code",[a._v(".shadow.camera")]),a._v("，然后再具体调试参数。")]),a._v(" "),t("div",{staticClass:"language-javascript extra-class"},[t("pre",{pre:!0,attrs:{class:"language-javascript"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// 设置三维场景计算阴影的范围")]),a._v("\ndirectionalLight"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("shadow"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("camera"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("left "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("100")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\ndirectionalLight"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("shadow"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("camera"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("right "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("100")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\ndirectionalLight"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("shadow"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("camera"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("top "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("100")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\ndirectionalLight"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("shadow"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("camera"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("bottom "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("100")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\ndirectionalLight"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("shadow"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("camera"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("near "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("0.5")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\ndirectionalLight"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("shadow"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("camera"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("far "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("100")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])])]),t("p",[t("code",[a._v("CameraHelper")]),a._v("辅助调试参数")]),a._v(" "),t("div",{staticClass:"language-javascript extra-class"},[t("pre",{pre:!0,attrs:{class:"language-javascript"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// 可视化平行光阴影对应的正投影相机对象")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("const")]),a._v(" cameraHelper "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("new")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("THREE"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("CameraHelper")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("directionalLight"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("shadow"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("camera"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\nscene"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("add")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("cameraHelper"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])])]),t("h3",{attrs:{id:"阴影条纹问题解决-shadowmap-type"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#阴影条纹问题解决-shadowmap-type"}},[a._v("#")]),a._v(" 阴影条纹问题解决"),t("code",[a._v(".shadowMap.type")])]),a._v(" "),t("p",[a._v("WebGL的渲染器的阴影贴图属性"),t("code",[a._v(".shadowMap")]),a._v("的属性值是一个对象，"),t("code",[a._v(".shadowMap")]),a._v("具有"),t("code",[a._v(".enabled")]),a._v("、"),t("code",[a._v(".type")]),a._v("等属性。")]),a._v(" "),t("p",[a._v("模型表面产生条纹影响渲染效果，可以改变"),t("code",[a._v(".shadowMap.type")]),a._v("默认值优化")]),a._v(" "),t("div",{staticClass:"language-javascript extra-class"},[t("pre",{pre:!0,attrs:{class:"language-javascript"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// 模型表面产生条纹影响渲染效果，可以改变.shadowMap.type默认值优化")]),a._v("\nrenderer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("shadowMap"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("type "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("THREE")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("VSMShadowMap"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v(" \n")])])]),t("h3",{attrs:{id:"阴影像素-shadow-mapsize"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#阴影像素-shadow-mapsize"}},[a._v("#")]),a._v(" 阴影像素"),t("code",[a._v(".shadow.mapSize")])]),a._v(" "),t("div",{staticClass:"language-javascript extra-class"},[t("pre",{pre:!0,attrs:{class:"language-javascript"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// 如果阴影边缘锯齿感的时候，可以适当提升像素")]),a._v("\ndirectionalLight"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("shadow"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("mapSize"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("set")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("1024")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("1024")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])])]),t("h3",{attrs:{id:"阴影边缘弱化-shadow-radius"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#阴影边缘弱化-shadow-radius"}},[a._v("#")]),a._v(" 阴影边缘弱化"),t("code",[a._v(".shadow.radius")])]),a._v(" "),t("div",{staticClass:"language-javascript extra-class"},[t("pre",{pre:!0,attrs:{class:"language-javascript"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// 模糊弱化阴影边缘")]),a._v("\ndirectionalLight"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("shadow"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("radius "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("3")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])])])])}),[],!1,null,null,null);t.default=e.exports}}]);