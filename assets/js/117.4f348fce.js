(window.webpackJsonp=window.webpackJsonp||[]).push([[117],{445:function(a,t,s){"use strict";s.r(t);var e=s(7),n=Object(e.a)({},(function(){var a=this,t=a._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[t("h1",{attrs:{id:"平行光阴影计算"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#平行光阴影计算"}},[a._v("#")]),a._v(" 平行光阴影计算")]),a._v(" "),t("p",[a._v("点光源"),t("code",[a._v("PointLight")]),a._v("、聚光源"),t("code",[a._v("SpotLight")]),a._v("、平行光"),t("code",[a._v("DirectionalLight")]),a._v("等都可以产生阴影，就像实际生活中的影子。")]),a._v(" "),t("p",[t("img",{attrs:{src:"/imgthreejs/%E5%85%89%E6%BA%90%E7%A4%BA%E6%84%8F%E5%9B%BE.png",alt:""}})]),a._v(" "),t("p",[a._v("环境光"),t("code",[a._v("AmbientLight")]),a._v("这种没有方向的光源，不会产生阴影。")]),a._v(" "),t("p",[a._v("本节课给大家讲解平行光"),t("code",[a._v("DirectionalLight")]),a._v("的阴影效果如何实现。")]),a._v(" "),t("h3",{attrs:{id:"平行光directionallight阴影步骤"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#平行光directionallight阴影步骤"}},[a._v("#")]),a._v(" 平行光"),t("code",[a._v("DirectionalLight")]),a._v("阴影步骤")]),a._v(" "),t("p",[a._v("平行光"),t("code",[a._v("DirectionalLight")]),a._v("阴影计算最少设置")]),a._v(" "),t("ul",[t("li",[a._v("1."),t("code",[a._v(".castShadow")]),a._v("设置"),t("strong",[a._v("产生阴影")]),a._v("的模型对象")]),a._v(" "),t("li",[a._v("2."),t("code",[a._v(".castShadow")]),a._v("设置"),t("strong",[a._v("产生阴影")]),a._v("的光源对象")]),a._v(" "),t("li",[a._v("3."),t("code",[a._v(".receiveShadow")]),a._v("设置"),t("strong",[a._v("接收阴影")]),a._v("效果的模型")]),a._v(" "),t("li",[a._v("4."),t("code",[a._v(".shadowMap.enabled")]),a._v("WebGl渲染器允许阴影渲染")]),a._v(" "),t("li",[a._v("5."),t("code",[a._v(".shadow.camera")]),a._v("设置光源阴影渲染范围")])]),a._v(" "),t("h3",{attrs:{id:"_1-模型阴影投射-castshadow"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-模型阴影投射-castshadow"}},[a._v("#")]),a._v(" 1. 模型阴影投射"),t("code",[a._v(".castShadow")])]),a._v(" "),t("p",[a._v("模型阴影投射属性"),t("code",[a._v(".castShadow")]),a._v("设置"),t("strong",[a._v("产生阴影")]),a._v("的模型对象")]),a._v(" "),t("div",{staticClass:"language-javascript extra-class"},[t("pre",{pre:!0,attrs:{class:"language-javascript"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// 设置产生投影的网格模型")]),a._v("\nmesh"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("castShadow "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[a._v("true")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])])]),t("h3",{attrs:{id:"_2-光源阴影投射属性-castshadow"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-光源阴影投射属性-castshadow"}},[a._v("#")]),a._v(" 2. 光源阴影投射属性"),t("code",[a._v(".castShadow")])]),a._v(" "),t("p",[a._v("和产生阴影的模型一样，光源也有阴影投射属性"),t("code",[a._v(".castShadow")]),a._v("属性，光源默认不产生阴影，需要代码开启。")]),a._v(" "),t("div",{staticClass:"language-javascript extra-class"},[t("pre",{pre:!0,attrs:{class:"language-javascript"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// 平行光")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("const")]),a._v(" directionalLight "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("new")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("THREE"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("DirectionalLight")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("0xffffff")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// 平行光设置产生阴影的光源对象,开启光源阴影的计算功能")]),a._v("\ndirectionalLight"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("castShadow "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[a._v("true")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])])]),t("h3",{attrs:{id:"_3-模型阴影接收属性-receiveshadow"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-模型阴影接收属性-receiveshadow"}},[a._v("#")]),a._v(" 3.模型阴影接收属性"),t("code",[a._v(".receiveShadow")])]),a._v(" "),t("p",[a._v("模型阴影接收属性"),t("code",[a._v(".castShadow")]),a._v("设置"),t("strong",[a._v("接收阴影")]),a._v("的模型对象")]),a._v(" "),t("div",{staticClass:"language-javascript extra-class"},[t("pre",{pre:!0,attrs:{class:"language-javascript"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// 设置接收阴影的投影面")]),a._v("\nplaneMesh"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("receiveShadow "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[a._v("true")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])])]),t("h3",{attrs:{id:"_4-shadowmap-enabled允许渲染器渲染阴影"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-shadowmap-enabled允许渲染器渲染阴影"}},[a._v("#")]),a._v(" 4. "),t("code",[a._v(".shadowMap.enabled")]),a._v("允许渲染器渲染阴影")]),a._v(" "),t("p",[a._v("WebGL的渲染器的阴影贴图属性"),t("code",[a._v(".shadowMap")]),a._v("的属性值是一个对象，"),t("code",[a._v(".shadowMap")]),a._v("具有"),t("code",[a._v(".enabled")]),a._v("、"),t("code",[a._v(".type")]),a._v("等属性。")]),a._v(" "),t("p",[a._v("设置"),t("code",[a._v(".shadowMap.enabled=true")]),a._v("允许WebGL渲染器渲染阴影。")]),a._v(" "),t("div",{staticClass:"language-javascript extra-class"},[t("pre",{pre:!0,attrs:{class:"language-javascript"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// 设置渲染器，允许光源阴影渲染")]),a._v("\nrenderer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("shadowMap"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("enabled "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[a._v("true")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v(" \n")])])]),t("h3",{attrs:{id:"_5-平行光阴影相机属性-shadow-camera-阴影渲染范围"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-平行光阴影相机属性-shadow-camera-阴影渲染范围"}},[a._v("#")]),a._v(" 5. 平行光阴影相机属性"),t("code",[a._v(".shadow.camera")]),a._v("(阴影渲染范围)")]),a._v(" "),t("p",[a._v("平行光"),t("code",[a._v("DirectionalLight")]),a._v("的"),t("code",[a._v(".shadow")]),a._v("属性是"),t("strong",[a._v("平行光阴影对象")]),t("code",[a._v("DirectionalLightShadow")]),a._v(",平行光阴影对象有一个相机属性"),t("code",[a._v("shadow.camera")]),a._v("。")]),a._v(" "),t("p",[a._v("平行光阴影相机属性"),t("code",[a._v(".shadow.camera")]),a._v("的属性值是一个正投影相机对象"),t("code",[a._v("OrthographicCamera")]),a._v("。")]),a._v(" "),t("div",{staticClass:"language-javascript extra-class"},[t("pre",{pre:!0,attrs:{class:"language-javascript"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// 查看平行光阴影相机属性")]),a._v("\nconsole"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("log")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'阴影相机属性'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("directionalLight"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("shadow"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("camera"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])])]),t("h3",{attrs:{id:"camerahelper可视化-shadow-camera"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#camerahelper可视化-shadow-camera"}},[a._v("#")]),a._v(" "),t("code",[a._v("CameraHelper")]),a._v("可视化"),t("code",[a._v(".shadow.camera")])]),a._v(" "),t("p",[t("code",[a._v("THREE.CameraHelper")]),a._v("可以用来可视化正投影相机、透视投影相机对象。")]),a._v(" "),t("div",{staticClass:"language-javascript extra-class"},[t("pre",{pre:!0,attrs:{class:"language-javascript"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// 可视化平行光阴影对应的正投影相机对象")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("const")]),a._v(" cameraHelper "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("new")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("THREE"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("CameraHelper")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("directionalLight"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("shadow"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("camera"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\nscene"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("add")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("cameraHelper"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])])]),t("p",[a._v("平行光阴影相机的位置"),t("code",[a._v(".shadow.camera.position")]),a._v("默认就是平行光的位置属性"),t("code",[a._v("directionalLight.position")]),a._v("。")]),a._v(" "),t("div",{staticClass:"language-javascript extra-class"},[t("pre",{pre:!0,attrs:{class:"language-javascript"}},[t("code",[a._v("console"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("log")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'shadow.camera位置'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("directionalLight"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("shadow"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("camera"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("position"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])])]),t("h3",{attrs:{id:"_5-shadow-camera设置阴影渲染范围"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-shadow-camera设置阴影渲染范围"}},[a._v("#")]),a._v(" 5. "),t("code",[a._v(".shadow.camera")]),a._v("设置阴影渲染范围")]),a._v(" "),t("p",[t("code",[a._v(".shadow.camera")]),a._v("属性值是正投影相机"),t("code",[a._v("OrthographicCamera")]),a._v("，所以"),t("code",[a._v(".shadow.camera")]),a._v("属性的用法可以参考前面讲解过的正投影相机"),t("code",[a._v("OrthographicCamera")]),a._v("。")]),a._v(" "),t("div",{staticClass:"language-javascript extra-class"},[t("pre",{pre:!0,attrs:{class:"language-javascript"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("OrthographicCamera")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v(" left"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" right"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" top"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" bottom"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" near"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" far "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n")])])]),t("p",[t("img",{attrs:{src:"/imgthreejs/%E6%AD%A3%E6%8A%95%E5%BD%B1%E5%8F%AF%E8%A7%86%E7%A9%BA%E9%97%B4.png",alt:""}})]),a._v(" "),t("p",[t("code",[a._v(".shadow.camera")]),a._v("作用是约束三维场景阴影计算范围，上下左右前后六个属性定义了一个长方体空间，在这个长方体空间内容的模型进行阴影计算。")]),a._v(" "),t("div",{staticClass:"language-javascript extra-class"},[t("pre",{pre:!0,attrs:{class:"language-javascript"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// 设置三维场景计算阴影的范围")]),a._v("\ndirectionalLight"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("shadow"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("camera"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("left "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("50")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\ndirectionalLight"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("shadow"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("camera"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("right "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("50")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\ndirectionalLight"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("shadow"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("camera"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("top "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("200")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\ndirectionalLight"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("shadow"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("camera"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("bottom "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("100")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\ndirectionalLight"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("shadow"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("camera"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("near "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("0.5")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\ndirectionalLight"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("shadow"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("camera"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("far "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("600")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])])]),t("p",[a._v("如果"),t("code",[a._v(".shadow.camera")]),a._v("的渲染范围设置不合理，可能会出现看不到阴影或者阴影不完整的现象。比如你把代码中"),t("code",[a._v(".far")]),a._v("、"),t("code",[a._v(".right")]),a._v("等相机属性设置小一些，观察阴影变化。")]),a._v(" "),t("h3",{attrs:{id:"测试-改变平行光位置-position观察阴影变化"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#测试-改变平行光位置-position观察阴影变化"}},[a._v("#")]),a._v(" 测试：改变平行光位置"),t("code",[a._v(".position")]),a._v("观察阴影变化")]),a._v(" "),t("p",[a._v("你可以改变平行光位置"),t("code",[a._v(".position")]),a._v("属性，观察光源阴影相机属性"),t("code",[a._v(".shadow.camera")]),a._v("变化，观察平行光的阴影变化。")])])}),[],!1,null,null,null);t.default=n.exports}}]);